# SRTM地形数据文件处理代码分析

## 概述
这是一个用于处理SRTM（Shuttle Radar Topography Mission）地形高程数据文件的C++类库。SRTM是NASA航天飞机雷达地形测绘任务产生的全球数字高程模型数据。

## 主要功能

### 核心功能
- **读取SRTM .hgt格式文件**：解析二进制高程数据文件
- **支持两种数据精度**：
  - SRTM1：1弧秒间隔（约30米分辨率），文件大小25,934,402字节
  - SRTM3：3弧秒间隔（约90米分辨率），文件大小2,884,802字节
- **地理坐标解析**：从文件名自动提取地理范围信息
- **高程数据处理**：处理16位有符号整数高程值

### 数据格式特点
- **字节序**：采用大端序（Motorola/IEEE字节序）
- **数据组织**：按行主序存储（行优先）
- **坐标系统**：WGS84/EGM96大地水准面
- **空值处理**：用-32768标识无效数据点

## 输入输出

### 输入
- **文件路径**：SRTM .hgt文件的完整路径
- **文件命名规范**：
  - 格式：`N00W000.hgt` 或 `S00E000.hgt`
  - N/S：表示北纬/南纬
  - 00：纬度值（西南角）
  - W/E：表示西经/东经  
  - 000：经度值（西南角）
  - 扩展名：.hgt 或 .HGT

### 输出
- **高程数据矩阵**：二维数组存储高程值
- **地理范围信息**：
  - 西南角坐标（纬度、经度）
  - 东北角坐标（纬度、经度）
  - 最小/最大高程值
- **数据规格参数**：
  - 纬度/经度间隔
  - 数据点数量

## 模块解析

### 1. 头文件（SrtmHgtFile.hpp）
```cpp
class SrtmHgtFile : public DataFile
```
- 继承自DataFile基类
- 声明了三个核心私有方法
- 提供SRTM数据加载功能

### 2. 核心方法分析

#### `loadData()` - 主加载函数
- **功能**：协调整个数据加载过程
- **流程**：
  1. 构建完整文件路径
  2. 打开二进制文件流
  3. 获取文件大小
  4. 解析文件信息
  5. 读取高程数据
  6. 关闭文件

#### `determineSrtmInfo()` - 文件信息解析
- **功能**：根据文件名和大小确定SRTM数据类型
- **解析内容**：
  - 根据文件大小判断SRTM1/SRTM3类型
  - 从文件名提取地理坐标
  - 设置数据间隔和网格大小
  - 验证文件名格式

#### `readSrtmData()` - 数据读取
- **功能**：读取实际的高程数据
- **处理过程**：
  - 分配二维数组内存
  - 按行读取高程值
  - 处理字节序转换
  - 计算最小/最大高程值

#### `readValue()` - 数值解析
- **功能**：解析16位有符号整数高程值
- **处理逻辑**：
  - 处理大端序字节序
  - 解析符号位
  - 组合高低字节

## 程序逻辑流程

### 1. 初始化阶段
```
构造函数 → 设置空值标识(-32768) → 调用基类构造函数
```

### 2. 数据加载流程
```
loadData() 调用
    ↓
构建文件路径
    ↓
打开二进制文件流
    ↓
获取文件大小
    ↓
determineSrtmInfo() - 解析文件信息
    ↓
readSrtmData() - 读取高程数据
    ↓
关闭文件，返回结果
```

### 3. 文件信息解析逻辑
```
检查文件大小 → 确定SRTM类型(1或3弧秒)
    ↓
验证文件扩展名(.hgt/.HGT)
    ↓
解析文件名 → 提取纬度/经度坐标
    ↓
设置数据网格参数
```

### 4. 数据读取逻辑
```
分配内存（二维数组）
    ↓
按行循环读取
    ↓
    按列循环读取 → readValue()解析字节
        ↓
    存储到数组中，倒序排列（南→北）
        ↓
    更新最小/最大高程值
```

## 关键技术点

### 1. 字节序处理
- SRTM数据采用大端序存储
- 需要正确处理高低字节顺序
- 符号位处理（最高位为符号位）

### 2. 内存管理
- 动态分配二维数组
- 按列分配，每列包含所有纬度点
- 需要适当的内存释放机制

### 3. 地理坐标系统
- 遵循DTED约定（左下角坐标）
- WGS84坐标系统
- 1度×1度的数据瓦片

### 4. 数据质量控制
- 识别并处理空值(-32768)
- 验证文件格式和大小
- 错误处理和日志记录

## 应用场景
- 地理信息系统(GIS)
- 地形可视化
- 飞行模拟器
- 地形分析和建模
- 导航系统地形数据