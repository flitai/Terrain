# aw3d2srtm格式转换脚本工具

### 脚本概述

该脚本是一个示例工具，其核心功能是将日本宇宙航空研究开发机构 (JAXA) 发布的 **ALOS World 3D - 30m (AW3D30)** 格式的 GeoTiff [高程数据](https://www.eorc.jaxa.jp/ALOS/en/aw3d30/data/index.htm)，转换为广泛使用的 **SRTM HGT** 格式。转换过程依赖于强大的地理空间数据处理库 **GDAL** 。

### 运行环境要求

要成功运行此脚本，系统需要满足以下条件：

  * **操作系统**：主要为 Linux 系统设计。同时，也可以在安装了特定兼容环境的 Windows 10 上运行，例如 **Cygwin** 或 **OSGeo4W**。
  * **必需软件**：
      * GDAL (地理空间数据抽象库) 
      * bash (Shell 环境) 
      * awk (文本处理工具) 

### 文件结构与使用方法

工具包的结构：

  * `aw3d2srtm.sh`: 实现转换功能的核心脚本文件。
  * `input/`文件夹，需要将下载的 AW3D30 GeoTiff 文件（特别是 `*_DSM.tif` 文件）放入此处 。
  * `output/`文件夹，脚本运行后生成的 HGT 文件会保存在这里 。

**使用步骤非常简单：**

1.  将所有需要转换的 AW3D30 GeoTiff 文件保存到 `input` 文件夹中。
2.  打开终端或命令行界面，执行以下命令来运行脚本：
    ```bash
    bash aw3d2srtm.sh
    ```
3.  脚本执行完毕后，转换好的 `.hgt` 文件就会出现在 `output` 文件夹中 。

### 核心处理流程解析

脚本的内部处理流程与 `readme_en.txt` 文件中的描述完全一致，主要分为以下几个关键步骤：

1.  **合并所有输入文件 (Merge Input Files)**

      * 脚本首先使用 `gdalbuildvrt` 命令，将 `input` 文件夹中所有以 `_DSM.tif` 结尾的文件合并成一个虚拟栅格文件 `input.vrt`。
      * 虚拟栅格（VRT）是一个轻量级的 XML 文件，它本身不存储像素数据，而是指向原始文件。这样做的好处是可以在不创建巨大中间文件的情况下，将多个零散的瓦片数据当作一个完整的数据集来处理。
      * **对应脚本命令:** `gdalbuildvrt ... ${vrtfile} ${INPUT_DIR}/*_DSM.tif`

2.  **循环处理、重采样与切片 (Loop, Resample and Subset)**

      * 脚本会遍历 `input` 文件夹中的每一个 `_DSM.tif` 文件，并为其生成对应的 `.hgt` 文件名。
      * 接着，它使用 `gdalwarp` 命令，从上一步生成的虚拟栅格 `input.vrt` 中进行裁切和重采样。
      * **裁切**：根据输入文件名（如 `N020E121`）计算出 1x1 度的经纬度范围，并从 `input.vrt` 中提取该范围的数据。
      * **重采样**：将裁切出的数据重采样为 3601x3601 像素的网格。这是 SRTM 1角秒（约30米）分辨率数据的标准尺寸。这一步是确保输出格式符合 SRTM HGT 标准的关键。
      * 处理后的结果会保存为一个临时的 GeoTiff 文件（例如 `N20E121.hgt.tif`）。
      * **对应脚本命令:** `gdalwarp ... ${vrtfile} ${OUTPUT_DIR}/${srtm}.tif`

3.  **最终格式转换 (Final Format Conversion)**

      * 最后，脚本使用 `gdal_translate` 命令将上一步生成的临时 GeoTiff 文件转换为最终的 **SRTMHGT** 格式。
      * **对应脚本命令:** `gdal_translate -of SRTMHGT ...`

4.  **清理临时文件 (Cleanup)**

      * 在每个文件转换成功后，脚本会删除过程中产生的临时 GeoTiff 文件。
      * 所有文件处理完毕后，脚本会删除 `input.vrt` 虚拟栅格文件。

### 重要注意事项

  * 为了确保瓦片边缘部分能够被精确地重采样，需要提供的输入文件应该比实际想转换的目标区域要大。例如，如果想转换 `N20E121` 这一个瓦片，最好将它周围的8个瓦片（N19E120, N19E121, ..., N21E122）也一并放入 `input` 文件夹，这样 `gdalwarp` 在处理边缘时能获取到相邻数据，插值结果会更准确。

### 免责声明

  * JAXA 明确表示，无论出于何种原因，对于因使用此示例脚本而导致的任何损害或损失，JAXA 概不负责。